**Decent RSA**

Author: EwaÃ«l - following [the writeup from the Cryptohack team](https://blog.cryptohack.org/cryptoctf2020#decent-rsa)

![enonce](enonce.png)

Let's start by extracting the parameters from the public key:

```
$ /opt/RsaCtfTool/RsaCtfTool.py --publickey mykey.pem --dumpkey
private argument is not set, the private key will not be displayed, even if recovered.
Details for mykey.pem:
n: 31973912565930840183966476557514486967105734963490863850242883813184363077890247373353346311197244652164393947531225033913089540524508960337859521594971267299801046318823852855678220562983993746120365799161402319433119943409550637861054248792884967164024537194083317326043002215575735008275047537805378975239548031416843476640326890142850615245392184058602194672466707234505010060517043706542794833490218200030153606086208410372554126103395033388764862282497594446045727336858065181330686078548554317618028148145081341511574658757428258020937703703371498976906228288914164074403171127516885244682134581893201619939353
e: 65537
```

Fermat factorization does not work at first. The solution is to look at `n` in various bases until finding something strange, which can easily be done using sagemath:

```
sage: n.str(base=2)
'11111101010010000011110010101110010100010000111101110010001011010101010001011100110010110001001111111001010000001110100011001011110000001101111111000101101101001100011101011111111111011100000100101011011010100001010011111000010100111101011010001000100101111111111000010010001001010000000100110011011011000111100001111010100111010011100010101001100111010101001000111011110100111110011010101010001111111101011000011111110110110010010000110010101100010111010100100111111100101101011110111001100011011110010101111110001110111100100100001010000111010000001101011101101011110101010101010011001001011111011001110100000000100110001001110110001101101011110100100010100010101111101100011010100100010111000011000010001101100001110100101010000111111000111000010001001100110101010111111011011011111100001001110001011111100001000110001000111110111110001111111011110000000010100110011001111001110101011010000010011111100000010111000101101001111010001010111110010010001011111001111111111101010011000000001101101011111011000010110011010101111101001101010011001110011000100011011111011011100110111111110011001010111101110010101111001000011110000101101110000001111001010001011010001000010111110011100100010000111111101000011100010100000001101010111101001110110001010100111110010111000101101100101110001010010001010100110000000000000111010101111110111011001100001101101110101010101000100110111101011011011010111011010111011111110011000011101001101111011000010100011111011101011010101101111011001101100000010111101010110101101100000011001001100101111010001111011000011101011111100011101010100110000111000000001110011011110100001011101100110001011101100000100111111110110001010010100001001011111000010011110000111111101101001011010110001100110001001100001001011010001101111111000000110000001000111000101001010011011101001000010100011010101110010001011010110101011110111001001101101010100000110001100111011010011101100111111000011101010101111100100101010111110011000100100100111010001101011001111011001111010100111011000101000011100100111111011100010111010111000000011001'
sage: n.str(base=3)
'101102200002121021021212220020002011000212102100202001121222121110011211020212111222002212101001110211100212202211021210100020221121211220211101022210110011201120001010200222020121202200000010121220022110012201211202210112000201000220020200210201002112101200112211122212010111110022201110010021220002120122010111201100002110202211121102002202121220101202122101001101221120210121020000202101001100112111201221221110012012102202021220222022100111101222011021201212100101111222120112110202220020112121000110122120222012201022200212022201202210120010201011000101100120011211221211221020112111010110110222222120222112121221211012100222212222120002111222210201211220220200010201010100121021012220200122021220102201122212022101112221201000101001221011101010022221200102021102020021001010211101200121200110210222211121011112222210120220222112120110122011110000012120220111112121001210102002101001100000020101101121002010111201022211022112121001002200212110120010102002001012200110000210220000112221211110220121010002112101010020010210100021002100112220202122121020122020121010122100010112100000101210022210001112001222002102112102022111120102002002110210220010102112111012221221212110212002200101021002100000120221001022002202010110210201212211222212222121021220102112221011102220202122221010221102102'
...
sage: n.str(base=11)
'10010000000000000000000000000000020000000000010000000000000000000000000000000000000000000002002000002000000000000000020020004000000000002000000000004040000000000020000000002000000000000000000400000000000000000000000004000000000000000000000800000000000000000000000408000000000000000200000004000000600200000000000000000000000000000400000000000200000000000000000000000000000040000000000000080000000040400000000000000800000000000000000000000000000080000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000008'
```

There it is. Lots of 0 in this base, I can now write it as a polynomial.

```
sage: poly = sum(e * x^i for i,e in enumerate(n.digits(11)))
sage: poly
x^592 + x^589 + 2*x^559 + x^547 + 2*x^501 + 2*x^498 + 2*x^492 + 2*x^475 + 2*x^472 + 4*x^468 + 2*x^456 + 4*x^444 + 4*x^442 + 2*x^430 + 2*x^420 + 4*x^401 + 4*x^375 + 8*x^353 + 4*x^329 + 8*x^327 + 2*x^311 + 4*x^303 + 6*x^296 + 2*x^293 + 4*x^263 + 2*x^251 + 4*x^220 + 8*x^205 + 4*x^196 + 4*x^194 + 8*x^179 + 8*x^148 + 4*x^124 + 4*x^15 + 8
```

And now sage can factor it:

```
sage: poly.factor()
(x^296 + x^293 + 2*x^263 + x^251 + 2*x^196 + 4*x^148 + 2*x^124 + 2*x^15 + 4)*(x^296 + 2*x^205 + 2*x^179 + 2)
```

I set `x = 11` to get both `p` and `q`:

```
sage: x = 11
sage: (x^296 + x^293 + 2*x^263 + x^251 + 2*x^196 + 4*x^148 + 2*x^124 + 2*x^15 + 4)
178879666367321797306889097888593237682016817784428274816313280688426535150744336100663738258433399579931125463230993781941673394549068668770856405985346219071828327791826313541995835825389300114134241321223681884355027322999626363153646031059388028375162129135057969840272058758742209553531971251667497682599
sage: (x^296 + 2*x^205 + 2*x^179 + 2)
178745372323502486648250292259547731882497740383375470271211389647426545774563379174721012328179536228902849348335785753064892185470437557630965689434906006707353711580986987058256416961588222214934672164128275598047618962235958689419772153936553146483744909335380089416800887458777762511622721462283374422847
```

And now I can decrypt the flag:

```
$ /opt/RsaCtfTool/RsaCtfTool.py --uncipherfile flag.enc -n 31973912565930840183966476557514486967105734963490863850242883813184363077890247373353346311197244652164393947531225033913089540524508960337859521594971267299801046318823852855678220562983993746120365799161402319433119943409550637861054248792884967164024537194083317326043002215575735008275047537805378975239548031416843476640326890142850615245392184058602194672466707234505010060517043706542794833490218200030153606086208410372554126103395033388764862282497594446045727336858065181330686078548554317618028148145081341511574658757428258020937703703371498976906228288914164074403171127516885244682134581893201619939353 -e 65537 -p 178879666367321797306889097888593237682016817784428274816313280688426535150744336100663738258433399579931125463230993781941673394549068668770856405985346219071828327791826313541995835825389300114134241321223681884355027322999626363153646031059388028375162129135057969840272058758742209553531971251667497682599 -q 178745372323502486648250292259547731882497740383375470271211389647426545774563379174721012328179536228902849348335785753064892185470437557630965689434906006707353711580986987058256416961588222214934672164128275598047618962235958689419772153936553146483744909335380089416800887458777762511622721462283374422847 --private

Results for /tmp/tmpkww66mpc:

Private key :
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEA/Ug8rlEPci1UXMsT+UDoy8DfxbTHX/3BK2oU+FPWiJf+EiUB
M2x4ep04qZ1SO9Pmqj/WH9skMrF1J/LXuY3lfjvJCh0DXa9VUyX2dAJidja9Ior7
GpFwwjYdKh+OETNV+2/CcX4RiPvj+8ApmedWgn4Fxaeivki+f/UwDa+ws1fTUzmI
325v8yvcryHhbgeUWiF85EP6HFAavTsVPlxbLikVMAB1fuzDbqqJvW2u138w6b2F
H3WrezYF6tbAyZej2HX46phwDm9C7MXYJ/sUoS+E8P7S1jMTCWjfwMCOKU3SFGrk
WtXuTaoMZ2nZ+HVfJV8xJOjWez1OxQ5P3F1wGQIDAQABAoIBAHdcpKQttU7Eh/5X
Aem0KkFjetFsWY0mQ/OWwZ0pvW+P2X9piwBV/Q0jrMFaT5e8S/ctsFZA6vUs5h5W
dk2OznlH6X1noN90soxF1rhjK020jDuMLbwekHomEGZ6inQWsk2VJJhhphfdRVqt
+6z49a73fvbgAnUUSRp6TRQWGPra184iq7EaUni7Nafwy2TUkOKLFoBpip8wYzB2
GM4+Ew8Ct0r80WDVRQBbcBxPkeNU1lSvv/e86ALOmJ6rnzabMfNC3xUZN8b8whCt
4eh5uofCSEnx9lN20h40r34VWMxj7bxDHgJEakPzbtMdXUa9ZXANY1aQV2v/EhWx
QW07N4UCgYEA/ruseJd9AlO4ATP9AF3uYpMhBedP1FhxSi9jWGedP7B+nHdmlrpB
ZFNAO4wh/5kV9cqF7oobUYmDdiwTB5/55c7SbNKia6BQgZt478rutlhdjaLVCfbN
dvBm7YIaDsJiVtqn2EJJk4WZM76wyhTPwQcMSgK4j/hMdm92t2HAhqcCgYEA/oq3
S+miAiISATPBzvi1LPorPBVp48vzrsllPfersUb+qJVKL9GzzXeqhfY3M4R6inEJ
DKUtZRhPX8AwLvHYfSQIK6uKdFPS1mR00D10UXlk6OOiILBoCrYwo8BnoMRFTmGu
mtN5XEuafgIRAuy3te2x33NBfc2pDhKbgce36z8CgYBN9m6Q8fxmq+zTIXA7noQJ
U3J19heuq+rwg5RqSDwOdBwsEzcoxpSg+gHct8ToD5hzA6r+GPLHf8jmcBLa8JFx
Tl2ExOrE+enp4QWgjoGE+YKYiM+fHxQ/ZNB7vKfxAHlMj9tzCsauCeObvK8rCjeT
om6WcELAfYQZc3/oHFjqXQKBgBuYbFDFjnPOv8bzloJawkGTCZbk92rj1JJRcTFr
pWh9uuQJ81YF1QlkfM8zJz7lkOdrY8DEM4yvOwO1cUPVolPG0T/yw/rij4wArg1Z
bD/c+kypSQ1kMpNetx05ocJzJNRfkK9mV9TiuWgJz1BS24PUtiD0fNgnsLk+2S8T
uOO/AoGAcTyscxKQfwsDHVX1c2+2/bEYJEriz0mzDBc/NwDvkpmwBRHS/fL4E8ti
GtGRUTuQmD634TguYtnhP4LcOvTqmHmu7sAQTH/Jn+5EBq6wM/1St5ZZYrwIierU
0jpg89XvBo4cQPJDy9mCNwjR6LSSrKq2er9I1tp1ZrjH3qnt9J8=
-----END RSA PRIVATE KEY-----

Unciphered data :
[b'\x00\x02\x98E\x8a/;_6B\x00----------------------------------------------------------------------------------\n  ...:: geart job, the flag is: CCTF{___RSA___1n_D3cEn7_W0rLd_cRyPtO5!!!} ::...\n----------------------------------------------------------------------------------']
```

Here is the flag:

`CCTF{___RSA___1n_D3cEn7_W0rLd_cRyPtO5!!!}`
