#!/usr/bin/env python3

# nc challenges2.france-cybersecurity-challenge.fr 4007

from pwn import *
from Crypto.Util.number import bytes_to_long
import time, os

os.system('echo FCSC{F4k3_fl44G} > /home/root/Bureau/flag.txt')

args = ['./malware', '--client', '-i', '127.0.0.1']
commands = '''
set follow-fork-mode child
# before send
b *0x402ae5
# after rec pub key
b *0x402b18
# call RSA_public_encrypt
b *0x402c4f
c
c
'''
# for malware debugging as client
#r = gdb.debug(args, commands)
#r.interactive()

for i in range(1000):
    r = process(args)
    time.sleep(0.75)
    print(f'trying n = {i}')
    os.system('ls')
    r.close()

'''
n = randint(0, 1000)
hash = sha256(login@hostname)
to_send = hash;n (ex: 9afbb9e2c87543a961f9a8f634af6bdf7339cc3d0955444189d1d5d4761a6a08;492)

0fdb0eea57198b3bb69e8267690ede5d5ba95ab791638a610372120b773d4acc_2021-03-15|21:34:41.priv
'''
