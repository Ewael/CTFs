#!/usr/bin/env python3

from Crypto.PublicKey import RSA
from Crypto.Util.number import bytes_to_long, long_to_bytes, getPrime
import gmpy2
import binascii

ct = 0x25b500947ef4b4b220398658c3d14b9fd764d103457a0d1033be05ce955f6250ec37f0d5d0f0cba52bae08fdc13cd61323b1937837f30074eeb97fc157830967a0ab9644b444a55a8b66fe3b485158b7e23f378b176731597c5f4872c091b522d83875a63ff9027793a2b6cec8c01dfb35e7721752c15e4af04b3e938b2d4391899a3fe3fd9b6ecbcd8b551db375df662409e9d1b9531bb3ca2667c6d25252629b027b3abb3741195a83f986d5ef8ed62a8f8b55c5380b881ff263a91d12b4b4e21f340596099572df2f22bbe686639b3250af01fda555fbf832978b8852015d70a797d56dd3581dc2a036c10a77e2e834d2b65fa83639eb4e2f0e6dce80c83e6fe12a77fb5de4dec125c1803ab47ceebcdcdccf2aa42eac825a056e6933c8e942c9697b92b436493adbf2682459a4841dc8192fd5f61542e4f4420f833664046050e86d82e0609999810de1b632fba953d1644e0b3b1278f7314ca8a

# read the public key in:
pubkey = RSA.importKey(open('pubkey', 'r').read())

print(f"{pubkey.n=}")
print(f"{pubkey.e=}")

p = 289190383812346094128890004165501072371720594541187756619635997259056462343231324497081791723449809468496124679457501494943275238199172789780756450624178411706713719171576134181144178211700839015425273354905914447362632225260536111846467148950291381069804874785033372254648254457554534191559335210163581619523746919923877273614760634997350074202916212391012107965894228168095931794101538514496496645733714103698730468749
q = 654561854599568510513803692967755379998416280422652609341190713281028301235557236749708818685296894726955809036146589394233692664652293812771835228683833804316181731699472210535019498384575888771578541264660183081380803035974932410313743127666575191331023378227323103512035066623731111714654725906820910420048943233802234704555280797642628192636757908460170005900413799755997416959555581736435658490167903067337237961813

phi = (p - 1) * (q - 1)

# compute modular inverse of e
d = gmpy2.invert(pubkey.e, phi)
print("[+] Priv key d = " + str(d))

pt = pow(ct, d, pubkey.n)
print(long_to_bytes(pt))

"""
HDCTF{F4ct0r_Db_F0r_THe_Win!}
"""
